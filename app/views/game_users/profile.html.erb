
<%= render "layouts/navbar" %>
<%= link_to 'Sign out' , destroy_user_session_path, method: :delete %>

<h1><%= "#{current_user.first_name}'s Profile" %></h1>
<br><br>

<% game_ids = GameUser.where(users_id: current_user.id).pluck(:games_id) %>

<h2>Upcoming Games</h2>
<% game_ids.each do |game_id| %>
  <% game = Game.where(id: game_id).pluck(:player_count, :location, :datetime, :user_id) %>
  <% if game[0][2] >= Date.today %>
    <% organiser = User.where(id: game[0][3]).pluck(:first_name, :last_name) %>
    <%= "#{game[0][0].to_i / 2} aside on #{game[0][2].localtime.strftime("%d/%m/%y @ %H:%M")} at #{game[0][1]}" %>
    <br>
    <%= "Organised by #{organiser[0][0]} #{organiser[0][1][0]}." %>
    <br><br>
  <% end %>
<% end %>

<h2>Past Games</h2>
<% game_ids.each do |game_id| %>
  <% game = Game.where(id: game_id).pluck(:player_count, :location, :datetime, :user_id) %>
   <% if game[0][2] < Date.today %>
    <% organiser = User.where(id: game[0][3]).pluck(:first_name, :last_name) %>
    <% player_ids = GameUser.where(games_id: game_id).pluck(:users_id) %>
    <% players = [] %>
    <% player_ids.each do |id| %>
      <% players << User.where(id: id).pluck(:first_name, :last_name) unless id == current_user.id%>
    <% end %>
    <% played_with = "" %>
    <% players.each do |player| %>
      <% played_with << "#{player[0][0]} #{player[0][1][0]}. " %>
    <% end %>
    <%= "#{game[0][0].to_i / 2} aside on #{game[0][2].localtime.strftime("%d/%m/%y")} at #{game[0][1]}" %>
    <br>
    <%= "Organised by #{organiser[0][0]} #{organiser[0][1][0]}." %>
        <br>
    <%= "You played with #{played_with}" %>
    <br>
   
<%= form_with model: @posts, url: posts_path do |form| %>
    <%= form.label :"Share your highlights of the game:", { class: "form-label"}%>
    <%= form.text_field :post_text, { class: "form-control"} %>
    <%= form.file_field :image, class: "form-control" %>
     <%= form.hidden_field :user_id, value:current_user.id  %>
      <%= form.hidden_field :games_id, value:game_id  %>
    <%= form.submit "Submit", class: "btn btn-primary"%>
<% end %>

    <br><br>
  <% end %>
<% end %>


